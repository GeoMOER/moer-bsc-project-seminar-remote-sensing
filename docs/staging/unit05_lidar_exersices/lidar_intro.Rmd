---
title: "LidR Tutorial"
author: "Marvin Ludwig"
date: "29/05/2020"
output: html_document
---

## Data acquisition

Please download "Lidar Data Lahntal" from the Ilias course directory "data" and save it in your project structure.
It may be advisable to create a subdirectory in your data folder for all the upcoming lidar processing.

## LidR

* If not already done, install the `lidR` package.
* Load the Lahntal Lidar data into R

```{r}
# install.packages(lidR)
library(lidR)
mof = readLAS("../data/lidar/lidar_2018_clipped.las")
str(mof)
```

The LAS file in R consists of four parts: data, header, bbox and proj4string. You can look at each part individually by using the ´@´ symbol. You should already be familiar with the bbox (bounding box, minimum rectangle which includes all data) and proj4string (reference system).

```{r}
mof@proj4string
mof@proj4string <- sp::CRS("+init=epsg:25832")
```

The header stores all sorts of meta data about the LAS file like the number of points and the name of the software which generated the file ("rlas R package" in this case). The data (surprise, surprise) contains the actual point information and is a simple data.frame with one row for each point. 

```{r}
head(mof@data)
```

A quick description of each column can be found in the [LAS Specifications](http://www.asprs.org/wp-content/uploads/2010/12/LAS_1_4_r13.pdf) by the American Society for Photogrammetry & Remote Sensing (ASPRS).

### Visual Data Exploration

* Plot the Lidar data
* Plot the Lidar data again, but experiment with different columns for the coloring of the points.
* What information could you gain from these plots?

```{r, eval = FALSE}
plot(mof)
plot(mof, color = "Classification")
```

The default coloration in ´plot.lasmetrics3d´ is just the Z value of the points. If we use e.g. the Classification to color each point we see, that the pointcloud is divided into ground points and non-ground points. This classification was done by the data provider [HLNUG](https://www.hlnug.de/). The meaning of the classification encoding can also be found in the [LAS Specifications](http://www.asprs.org/wp-content/uploads/2010/12/LAS_1_4_r13.pdf)

```{r}
unique(mof@data$Classification)
```



##### Attribute Filter

* Filter the Lidar data. Only keep points above an intensity value above 300.
* Plot them. What points are these? What could you do with those points?
* Filter the Lidar data. Only keep points which belong to the classification "2".
* Plot them. What points are these? What could you do with those points?

```{r, eval = FALSE}
# filter functions

mof_intense = lasfilter(mof, Intensity > 300)
plot(mof_intense)

plot(lasfilter(mof, Classification == 2))
unique(mof@data$Classification)
```

If we plot only the points with an intensity above 300, only ground points and some trees are left in the pointcloud (in this case the conifers). With a bit more effort to find appropriate thresholds, the intensity could be used to discriminate between different tree species. If we filter the points after the classification we end up with the ground points only. We can use this to calculate a **digital elevation model**.
