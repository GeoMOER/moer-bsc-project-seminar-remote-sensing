---
title: "Lidar Vegetation Indices"
author: "Marvin Ludwig"
date: "29/05/2020"
output: html_document
---

The Sentinel Grid topography will now be the basis for the calculation of the mean vegetation height we already saw in the introduction paper.


```{r}

mof <- readLAS("../data/lidar/lidar_2018_clipped.las")

sen <- raster::raster("../data/sentinel/lahntal_sentinel.tif")
sen <- crop(sen, extent(mof))

# calculate DEM based on Sentinel Grid
dem = grid_metrics(las = mof, res = sen, func = ~min(Z), filter = ~Classification == 2)
plot(dem)

# Normalize the pointcloud
# this is similar as a chm but uses the 3D poiintcloud
mof_norm = lasnormalize(mof, dem, na.rm = TRUE)

# have a look at the effect
range(mof@data$Z)
range(mof_norm@data$Z)

# calculate the mean vegetation height
mvh <- grid_metrics(mof_norm, res = sen, func = ~mean(Z), filter = ~Classification != 2)
plot(mvh)
```




