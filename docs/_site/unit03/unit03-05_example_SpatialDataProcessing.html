<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.13.0 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Example: Workflow in R | Lab of Environmental Informatics</title>
<meta name="description" content="This example provides a schematic workflow for processing vector and raster data in R.Get raster dataFirstly, we import some raster data into our working environmentTherefore, we need to load a package to handle raster data in R, preferable raster.If the package is not available, we need to install it first with install.packages(&quot;raster&quot;).library(&quot;raster&quot;)We now can use the function getData() to download some raster data: In this example a global map of precipitation values at 10 minutes spatial resolution.prec &lt;- getData(&quot;worldclim&quot;, var=&quot;prec&quot;, res=10)Fortunately, the downloaded data already have a correct CRS:## class      : RasterStack ## dimensions : 900, 2160, 1944000, 12  (nrow, ncol, ncell, nlayers)## resolution : 0.1666667, 0.1666667  (x, y)## extent     : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)## crs        : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 ## names      : prec1, prec2, prec3, prec4, prec5, prec6, prec7, prec8, prec9, prec10, prec11, prec12 ## min values :     0,     0,     0,     0,     0,     0,     0,     0,     0,      0,      0,      0 ## max values :   885,   736,   719,   820,   955,  1850,  2088,  1386,   904,    980,    893,    914 … and can be quickly and simply visualized with plot(). Note that the object type is a RasterStack with 12 layers, one for each month of the year.plot(prec$prec1)Get vector dataSecondly, we add some vector data to our working environment. For example the administrative boundaries of France at the country level:fra &lt;- getData(&#39;GADM&#39;, country=&#39;FRA&#39;, level=0)Fortunately, also these downloaded data already have a CRS, defined by a proj4 string:## class       : SpatialPolygonsDataFrame ## features    : 1 ## extent      : -5.143751, 9.560416, 41.33375, 51.0894  (xmin, xmax, ymin, ymax)## crs         : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 ## variables   : 2## names       : GID_0, NAME_0 ## value       :   FRA, France Note that the object type here is a SpatialPolygonsDataFrame (defined in package sp) with one feature (i.e. with a single polygon), a certain extent (which can also be extracted with extent(fra)), a CRS (which also be extracted with CRS(fra)), and two variables with some values (in this case country abbreviation and name).Also vector data can quickly and simply be visualized with plot()plot(fra)Set extentWe can use the extent of one spatial object to crop (i.e. to cut out) another spatial object.In this example, we will crop the raster map(s) with the extent defined in the vector object. This is going to work because both objects have the same coordinates and CRS.Note that crop() processes all layers in the input raster stack.cropped_prec &lt;- crop(prec, extent(fra))For function arguments see ?crop(). Now we have precipitation maps of France:plot(cropped_prec$prec1)Vector operationsA simple vector operation would be to clip a spatial object not by the extent of another spatial object but by features or polygons of any shape.We will now use the country boundary of France for clipping of the already cropped precipitation maps with the mask() function of the raster package:clipped_prec &lt;- mask(cropped_prec, fra)The result is a RasterBrick object with 12 layers, one for each month of the year (the difference to a RasterStack as obove is only how memory is allocated, what does not matter here).Again, the result can quickly and simply be visualized with plot()plot(clipped_prec$prec1)Raster operationsThe created RasterBrick now contains precipitation values of France on a monthly basis. What if we want to have a single precipitation layer with annual precipitation values?We would need to sum up the values of all 12 precipitation layers for each pixel location.This can be done by:clipped_prec_sum &lt;- sum(clipped_prec)An alternative would be to use stackApply() (see ?stackApply() for details. Note the na.rm argument).clipped_prec_sum_2 &lt;- raster::stackApply(clipped_prec, rep(1,12), sum, na.rm=FALSE)The resulting raster map looks like this:plot(clipped_prec_sum)Note the different value range, which now stands for the annual amount of precipitation (in mm).MappingWe now combine all the above created spatial objects to create a single simple map:plot(clipped_prec_sum)plot(fra, add=T)points(2.349014, 48.864716, pch=8, cex=2) # roughly the location of ParisWrite outThe above created overlay of maps can be written to file as an ordinary image with e.g.jpeg(&quot;FirstSimpleMap.jpg&quot;)plot(clipped_prec_sum)plot(fra, add=T)points(2.349014, 48.864716, pch=8, cex=2)dev.off()Note that this is a raster image without geographic information.If you want to write out the spatial objects with geographic information, use e.g. raster::writeRaster() or raster::shapefile().Other important functions  Reading in raster data from file: raster::raster()  Reading in vector data from file: rgdal::readOGR()More informationFor more details see www.rspatial.org and Geocomputation with R">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Lab of Environmental Informatics">
<meta property="og:title" content="Example: Workflow in R">
<meta property="og:url" content="http://localhost:4000/moer-bsc-project-seminar-SDM/unit03/unit03-05_example_SpatialDataProcessing.html">


  <meta property="og:description" content="This example provides a schematic workflow for processing vector and raster data in R.Get raster dataFirstly, we import some raster data into our working environmentTherefore, we need to load a package to handle raster data in R, preferable raster.If the package is not available, we need to install it first with install.packages(&quot;raster&quot;).library(&quot;raster&quot;)We now can use the function getData() to download some raster data: In this example a global map of precipitation values at 10 minutes spatial resolution.prec &lt;- getData(&quot;worldclim&quot;, var=&quot;prec&quot;, res=10)Fortunately, the downloaded data already have a correct CRS:## class      : RasterStack ## dimensions : 900, 2160, 1944000, 12  (nrow, ncol, ncell, nlayers)## resolution : 0.1666667, 0.1666667  (x, y)## extent     : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)## crs        : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 ## names      : prec1, prec2, prec3, prec4, prec5, prec6, prec7, prec8, prec9, prec10, prec11, prec12 ## min values :     0,     0,     0,     0,     0,     0,     0,     0,     0,      0,      0,      0 ## max values :   885,   736,   719,   820,   955,  1850,  2088,  1386,   904,    980,    893,    914 … and can be quickly and simply visualized with plot(). Note that the object type is a RasterStack with 12 layers, one for each month of the year.plot(prec$prec1)Get vector dataSecondly, we add some vector data to our working environment. For example the administrative boundaries of France at the country level:fra &lt;- getData(&#39;GADM&#39;, country=&#39;FRA&#39;, level=0)Fortunately, also these downloaded data already have a CRS, defined by a proj4 string:## class       : SpatialPolygonsDataFrame ## features    : 1 ## extent      : -5.143751, 9.560416, 41.33375, 51.0894  (xmin, xmax, ymin, ymax)## crs         : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 ## variables   : 2## names       : GID_0, NAME_0 ## value       :   FRA, France Note that the object type here is a SpatialPolygonsDataFrame (defined in package sp) with one feature (i.e. with a single polygon), a certain extent (which can also be extracted with extent(fra)), a CRS (which also be extracted with CRS(fra)), and two variables with some values (in this case country abbreviation and name).Also vector data can quickly and simply be visualized with plot()plot(fra)Set extentWe can use the extent of one spatial object to crop (i.e. to cut out) another spatial object.In this example, we will crop the raster map(s) with the extent defined in the vector object. This is going to work because both objects have the same coordinates and CRS.Note that crop() processes all layers in the input raster stack.cropped_prec &lt;- crop(prec, extent(fra))For function arguments see ?crop(). Now we have precipitation maps of France:plot(cropped_prec$prec1)Vector operationsA simple vector operation would be to clip a spatial object not by the extent of another spatial object but by features or polygons of any shape.We will now use the country boundary of France for clipping of the already cropped precipitation maps with the mask() function of the raster package:clipped_prec &lt;- mask(cropped_prec, fra)The result is a RasterBrick object with 12 layers, one for each month of the year (the difference to a RasterStack as obove is only how memory is allocated, what does not matter here).Again, the result can quickly and simply be visualized with plot()plot(clipped_prec$prec1)Raster operationsThe created RasterBrick now contains precipitation values of France on a monthly basis. What if we want to have a single precipitation layer with annual precipitation values?We would need to sum up the values of all 12 precipitation layers for each pixel location.This can be done by:clipped_prec_sum &lt;- sum(clipped_prec)An alternative would be to use stackApply() (see ?stackApply() for details. Note the na.rm argument).clipped_prec_sum_2 &lt;- raster::stackApply(clipped_prec, rep(1,12), sum, na.rm=FALSE)The resulting raster map looks like this:plot(clipped_prec_sum)Note the different value range, which now stands for the annual amount of precipitation (in mm).MappingWe now combine all the above created spatial objects to create a single simple map:plot(clipped_prec_sum)plot(fra, add=T)points(2.349014, 48.864716, pch=8, cex=2) # roughly the location of ParisWrite outThe above created overlay of maps can be written to file as an ordinary image with e.g.jpeg(&quot;FirstSimpleMap.jpg&quot;)plot(clipped_prec_sum)plot(fra, add=T)points(2.349014, 48.864716, pch=8, cex=2)dev.off()Note that this is a raster image without geographic information.If you want to write out the spatial objects with geographic information, use e.g. raster::writeRaster() or raster::shapefile().Other important functions  Reading in raster data from file: raster::raster()  Reading in vector data from file: rgdal::readOGR()More informationFor more details see www.rspatial.org and Geocomputation with R">





  <meta name="twitter:site" content="@EnvIn_UMR">
  <meta name="twitter:title" content="Example: Workflow in R">
  <meta name="twitter:description" content="This example provides a schematic workflow for processing vector and raster data in R.Get raster dataFirstly, we import some raster data into our working environmentTherefore, we need to load a package to handle raster data in R, preferable raster.If the package is not available, we need to install it first with install.packages(&quot;raster&quot;).library(&quot;raster&quot;)We now can use the function getData() to download some raster data: In this example a global map of precipitation values at 10 minutes spatial resolution.prec &lt;- getData(&quot;worldclim&quot;, var=&quot;prec&quot;, res=10)Fortunately, the downloaded data already have a correct CRS:## class      : RasterStack ## dimensions : 900, 2160, 1944000, 12  (nrow, ncol, ncell, nlayers)## resolution : 0.1666667, 0.1666667  (x, y)## extent     : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)## crs        : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 ## names      : prec1, prec2, prec3, prec4, prec5, prec6, prec7, prec8, prec9, prec10, prec11, prec12 ## min values :     0,     0,     0,     0,     0,     0,     0,     0,     0,      0,      0,      0 ## max values :   885,   736,   719,   820,   955,  1850,  2088,  1386,   904,    980,    893,    914 … and can be quickly and simply visualized with plot(). Note that the object type is a RasterStack with 12 layers, one for each month of the year.plot(prec$prec1)Get vector dataSecondly, we add some vector data to our working environment. For example the administrative boundaries of France at the country level:fra &lt;- getData(&#39;GADM&#39;, country=&#39;FRA&#39;, level=0)Fortunately, also these downloaded data already have a CRS, defined by a proj4 string:## class       : SpatialPolygonsDataFrame ## features    : 1 ## extent      : -5.143751, 9.560416, 41.33375, 51.0894  (xmin, xmax, ymin, ymax)## crs         : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 ## variables   : 2## names       : GID_0, NAME_0 ## value       :   FRA, France Note that the object type here is a SpatialPolygonsDataFrame (defined in package sp) with one feature (i.e. with a single polygon), a certain extent (which can also be extracted with extent(fra)), a CRS (which also be extracted with CRS(fra)), and two variables with some values (in this case country abbreviation and name).Also vector data can quickly and simply be visualized with plot()plot(fra)Set extentWe can use the extent of one spatial object to crop (i.e. to cut out) another spatial object.In this example, we will crop the raster map(s) with the extent defined in the vector object. This is going to work because both objects have the same coordinates and CRS.Note that crop() processes all layers in the input raster stack.cropped_prec &lt;- crop(prec, extent(fra))For function arguments see ?crop(). Now we have precipitation maps of France:plot(cropped_prec$prec1)Vector operationsA simple vector operation would be to clip a spatial object not by the extent of another spatial object but by features or polygons of any shape.We will now use the country boundary of France for clipping of the already cropped precipitation maps with the mask() function of the raster package:clipped_prec &lt;- mask(cropped_prec, fra)The result is a RasterBrick object with 12 layers, one for each month of the year (the difference to a RasterStack as obove is only how memory is allocated, what does not matter here).Again, the result can quickly and simply be visualized with plot()plot(clipped_prec$prec1)Raster operationsThe created RasterBrick now contains precipitation values of France on a monthly basis. What if we want to have a single precipitation layer with annual precipitation values?We would need to sum up the values of all 12 precipitation layers for each pixel location.This can be done by:clipped_prec_sum &lt;- sum(clipped_prec)An alternative would be to use stackApply() (see ?stackApply() for details. Note the na.rm argument).clipped_prec_sum_2 &lt;- raster::stackApply(clipped_prec, rep(1,12), sum, na.rm=FALSE)The resulting raster map looks like this:plot(clipped_prec_sum)Note the different value range, which now stands for the annual amount of precipitation (in mm).MappingWe now combine all the above created spatial objects to create a single simple map:plot(clipped_prec_sum)plot(fra, add=T)points(2.349014, 48.864716, pch=8, cex=2) # roughly the location of ParisWrite outThe above created overlay of maps can be written to file as an ordinary image with e.g.jpeg(&quot;FirstSimpleMap.jpg&quot;)plot(clipped_prec_sum)plot(fra, add=T)points(2.349014, 48.864716, pch=8, cex=2)dev.off()Note that this is a raster image without geographic information.If you want to write out the spatial objects with geographic information, use e.g. raster::writeRaster() or raster::shapefile().Other important functions  Reading in raster data from file: raster::raster()  Reading in vector data from file: rgdal::readOGR()More informationFor more details see www.rspatial.org and Geocomputation with R">
  <meta name="twitter:url" content="http://localhost:4000/moer-bsc-project-seminar-SDM/unit03/unit03-05_example_SpatialDataProcessing.html">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2020-02-12T16:54:47+01:00">






<link rel="canonical" href="http://localhost:4000/moer-bsc-project-seminar-SDM/unit03/unit03-05_example_SpatialDataProcessing.html">













<!-- end _includes/seo.html -->


<link href="/moer-bsc-project-seminar-SDM/feed.xml" type="application/atom+xml" rel="alternate" title="Lab of Environmental Informatics Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/moer-bsc-project-seminar-SDM/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
    	<a class="site-title" href="http://localhost:4000/moer-bsc-project-seminar-SDM/" style="padding:0px"><img src="http://localhost:4000/moer-bsc-project-seminar-SDM/assets/images/logo_umr.png" style="padding-right:15px">Lab of Environmental Informatics</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/moer-bsc-project-seminar-SDM//units.html" >Course units</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/moer-bsc-project-seminar-SDM//about.html" >About</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/moer-bsc-project-seminar-SDM//index.html" >Course home</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://oer.uni-marburg.de/goto.php?target=crs_326&client_id=mriliasmooc" >OER home</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/moer-bsc-project-seminar-SDM//sitemap.html" >Sitemap</a>
            </li>
          
        </ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  

  <div class="sidebar sticky">
  

  
    
      
      
      
    
    
	  
        <nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      
      
    
      
      
    
      
      
        
        <li>
          <span class="nav__sub-title">
		     <a href="/moer-bsc-project-seminar-SDM//unit01/unit01-01_the_very_basics.html" class="">01 The very basics</a>
		  </span>
          <ul>
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
          </ul>
        </li>
	  
    
      
      
        
        <li>
          <span class="nav__sub-title">
		     <a href="/moer-bsc-project-seminar-SDM//unit02/unit02-01_more_basics.html" class="">02 More basics</a>
		  </span>
          <ul>
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
              
			  
            
          </ul>
        </li>
	  
    
      
      
        
        <li>
          <span class="nav__sub-title">
		     <a href="/moer-bsc-project-seminar-SDM//unit03/unit03-01_spatial_data.html" class="">03 Working with spatial data</a>
		  </span>
          <ul>
            
              
			  
			    <li><a href="/moer-bsc-project-seminar-SDM//unit03/unit03-01_spatial_data.html" class="">Spatial Data</a></li>
			  
            
              
			  
			    <li><a href="/moer-bsc-project-seminar-SDM//unit03/unit03-02_vector_data.html" class="">Vector Data</a></li>
			  
            
              
			  
			    <li><a href="/moer-bsc-project-seminar-SDM//unit03/unit03-03_raster_data.html" class="">Raster Data</a></li>
			  
            
              
			  
			    <li><a href="/moer-bsc-project-seminar-SDM//unit03/unit03-04_CRS.html" class="">Coordinate Reference Systems</a></li>
			  
            
              
			  
			    <li><a href="/moer-bsc-project-seminar-SDM//unit03/unit03-05_example_SpatialDataProcessing.html" class="active">Example: Workflow in R</a></li>
			  
            
              
			  
			    <li><a href="/moer-bsc-project-seminar-SDM//unit03/unit03-06_exercise_SpatialDataProcessing.html" class="">Exercise: Spatial Data Processing</a></li>
			  
            
          </ul>
        </li>
	  
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
  </ul>
</nav>
	  
    
  
  </div>
  






  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Example: Workflow in R">
    <meta itemprop="description" content="This example provides a schematic workflow for processing vector and raster data in R.Get raster dataFirstly, we import some raster data into our working environmentTherefore, we need to load a package to handle raster data in R, preferable raster.If the package is not available, we need to install it first with install.packages(&quot;raster&quot;).library(&quot;raster&quot;)We now can use the function getData() to download some raster data: In this example a global map of precipitation values at 10 minutes spatial resolution.prec &lt;- getData(&quot;worldclim&quot;, var=&quot;prec&quot;, res=10)Fortunately, the downloaded data already have a correct CRS:## class      : RasterStack ## dimensions : 900, 2160, 1944000, 12  (nrow, ncol, ncell, nlayers)## resolution : 0.1666667, 0.1666667  (x, y)## extent     : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)## crs        : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 ## names      : prec1, prec2, prec3, prec4, prec5, prec6, prec7, prec8, prec9, prec10, prec11, prec12 ## min values :     0,     0,     0,     0,     0,     0,     0,     0,     0,      0,      0,      0 ## max values :   885,   736,   719,   820,   955,  1850,  2088,  1386,   904,    980,    893,    914 … and can be quickly and simply visualized with plot(). Note that the object type is a RasterStack with 12 layers, one for each month of the year.plot(prec$prec1)Get vector dataSecondly, we add some vector data to our working environment. For example the administrative boundaries of France at the country level:fra &lt;- getData(&#39;GADM&#39;, country=&#39;FRA&#39;, level=0)Fortunately, also these downloaded data already have a CRS, defined by a proj4 string:## class       : SpatialPolygonsDataFrame ## features    : 1 ## extent      : -5.143751, 9.560416, 41.33375, 51.0894  (xmin, xmax, ymin, ymax)## crs         : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 ## variables   : 2## names       : GID_0, NAME_0 ## value       :   FRA, France Note that the object type here is a SpatialPolygonsDataFrame (defined in package sp) with one feature (i.e. with a single polygon), a certain extent (which can also be extracted with extent(fra)), a CRS (which also be extracted with CRS(fra)), and two variables with some values (in this case country abbreviation and name).Also vector data can quickly and simply be visualized with plot()plot(fra)Set extentWe can use the extent of one spatial object to crop (i.e. to cut out) another spatial object.In this example, we will crop the raster map(s) with the extent defined in the vector object. This is going to work because both objects have the same coordinates and CRS.Note that crop() processes all layers in the input raster stack.cropped_prec &lt;- crop(prec, extent(fra))For function arguments see ?crop(). Now we have precipitation maps of France:plot(cropped_prec$prec1)Vector operationsA simple vector operation would be to clip a spatial object not by the extent of another spatial object but by features or polygons of any shape.We will now use the country boundary of France for clipping of the already cropped precipitation maps with the mask() function of the raster package:clipped_prec &lt;- mask(cropped_prec, fra)The result is a RasterBrick object with 12 layers, one for each month of the year (the difference to a RasterStack as obove is only how memory is allocated, what does not matter here).Again, the result can quickly and simply be visualized with plot()plot(clipped_prec$prec1)Raster operationsThe created RasterBrick now contains precipitation values of France on a monthly basis. What if we want to have a single precipitation layer with annual precipitation values?We would need to sum up the values of all 12 precipitation layers for each pixel location.This can be done by:clipped_prec_sum &lt;- sum(clipped_prec)An alternative would be to use stackApply() (see ?stackApply() for details. Note the na.rm argument).clipped_prec_sum_2 &lt;- raster::stackApply(clipped_prec, rep(1,12), sum, na.rm=FALSE)The resulting raster map looks like this:plot(clipped_prec_sum)Note the different value range, which now stands for the annual amount of precipitation (in mm).MappingWe now combine all the above created spatial objects to create a single simple map:plot(clipped_prec_sum)plot(fra, add=T)points(2.349014, 48.864716, pch=8, cex=2) # roughly the location of ParisWrite outThe above created overlay of maps can be written to file as an ordinary image with e.g.jpeg(&quot;FirstSimpleMap.jpg&quot;)plot(clipped_prec_sum)plot(fra, add=T)points(2.349014, 48.864716, pch=8, cex=2)dev.off()Note that this is a raster image without geographic information.If you want to write out the spatial objects with geographic information, use e.g. raster::writeRaster() or raster::shapefile().Other important functions  Reading in raster data from file: raster::raster()  Reading in vector data from file: rgdal::readOGR()More informationFor more details see www.rspatial.org and Geocomputation with R">
    <meta itemprop="datePublished" content="February 12, 2020">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Example: Workflow in R
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> In this example</h4></header>
              <ul class="toc__menu">
  <li><a href="#get-raster-data">Get raster data</a></li>
  <li><a href="#get-vector-data">Get vector data</a></li>
  <li><a href="#set-extent">Set extent</a></li>
  <li><a href="#vector-operations">Vector operations</a></li>
  <li><a href="#raster-operations">Raster operations</a></li>
  <li><a href="#mapping">Mapping</a></li>
  <li><a href="#write-out">Write out</a></li>
  <li><a href="#other-important-functions">Other important functions</a></li>
  <li><a href="#more-information">More information</a></li>
</ul>
            </nav>
          </aside>
        
        <p>This example provides a schematic workflow for processing vector and raster data in R.</p>

<h2 id="get-raster-data">Get raster data</h2>

<p>Firstly, we import some raster data into our working environment
Therefore, we need to load a package to handle raster data in R, preferable <code class="highlighter-rouge">raster</code>.
If the package is not available, we need to install it first with <code class="highlighter-rouge">install.packages("raster")</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"raster"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>We now can use the function <code class="highlighter-rouge">getData()</code> to download some raster data: In this example a global map of precipitation values at 10 minutes spatial resolution.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">prec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="s2">"worldclim"</span><span class="p">,</span><span class="w"> </span><span class="n">var</span><span class="o">=</span><span class="s2">"prec"</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Fortunately, the downloaded data already have a correct CRS:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## class      : RasterStack </span><span class="w">
</span><span class="c1">## dimensions : 900, 2160, 1944000, 12  (nrow, ncol, ncell, nlayers)</span><span class="w">
</span><span class="c1">## resolution : 0.1666667, 0.1666667  (x, y)</span><span class="w">
</span><span class="c1">## extent     : -180, 180, -60, 90  (xmin, xmax, ymin, ymax)</span><span class="w">
</span><span class="c1">## crs        : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 </span><span class="w">
</span><span class="c1">## names      : prec1, prec2, prec3, prec4, prec5, prec6, prec7, prec8, prec9, prec10, prec11, prec12 </span><span class="w">
</span><span class="c1">## min values :     0,     0,     0,     0,     0,     0,     0,     0,     0,      0,      0,      0 </span><span class="w">
</span><span class="c1">## max values :   885,   736,   719,   820,   955,  1850,  2088,  1386,   904,    980,    893,    914 </span><span class="w">
</span></code></pre></div></div>

<p>… and can be quickly and simply visualized with <code class="highlighter-rouge">plot()</code>. 
Note that the object type is a <code class="highlighter-rouge">RasterStack</code> with 12 layers, one for each month of the year.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">prec</span><span class="o">$</span><span class="n">prec1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="/moer-bsc-project-seminar-SDM//assets/images/maps/map_prec1_global.png" style="display: block; margin: auto;" /></p>

<h2 id="get-vector-data">Get vector data</h2>

<p>Secondly, we add some vector data to our working environment. For example the administrative boundaries of France at the country level:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fra</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="s1">'GADM'</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="o">=</span><span class="s1">'FRA'</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Fortunately, also these downloaded data already have a CRS, defined by a <em>proj4 string</em>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## class       : SpatialPolygonsDataFrame </span><span class="w">
</span><span class="c1">## features    : 1 </span><span class="w">
</span><span class="c1">## extent      : -5.143751, 9.560416, 41.33375, 51.0894  (xmin, xmax, ymin, ymax)</span><span class="w">
</span><span class="c1">## crs         : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 </span><span class="w">
</span><span class="c1">## variables   : 2</span><span class="w">
</span><span class="c1">## names       : GID_0, NAME_0 </span><span class="w">
</span><span class="c1">## value       :   FRA, France </span><span class="w">
</span></code></pre></div></div>

<p>Note that the object type here is a <code class="highlighter-rouge">SpatialPolygonsDataFrame</code> (defined in package <code class="highlighter-rouge">sp</code>) with one <em>feature</em> (i.e. with a single polygon), 
a certain <em>extent</em> (which can also be extracted with <code class="highlighter-rouge">extent(fra)</code>), a <em>CRS</em> (which also be extracted with <code class="highlighter-rouge">CRS(fra)</code>), and two <em>variables</em> with some <em>values</em> (in this case country abbreviation and name).</p>

<p>Also vector data can quickly and simply be visualized with <code class="highlighter-rouge">plot()</code></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">fra</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="/moer-bsc-project-seminar-SDM//assets/images/maps/map_france_GADM.png" style="display: block; margin: auto;" /></p>

<h2 id="set-extent">Set extent</h2>

<p>We can use the extent of one spatial object to <em>crop</em> (i.e. to cut out) another spatial object.
In this example, we will crop the raster map(s) with the extent defined in the vector object. 
This is going to work because both objects have the same coordinates and CRS.
Note that <code class="highlighter-rouge">crop()</code> processes all layers in the input raster stack.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cropped_prec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">crop</span><span class="p">(</span><span class="n">prec</span><span class="p">,</span><span class="w"> </span><span class="n">extent</span><span class="p">(</span><span class="n">fra</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>For function arguments see <code class="highlighter-rouge">?crop()</code>. Now we have precipitation maps of France:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">cropped_prec</span><span class="o">$</span><span class="n">prec1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="/moer-bsc-project-seminar-SDM//assets/images/maps/map_prec_cropped.png" style="display: block; margin: auto;" /></p>

<h2 id="vector-operations">Vector operations</h2>

<p>A simple vector operation would be to clip a spatial object not by the extent of another spatial object but by features or polygons of any shape.</p>

<p>We will now use the country boundary of France for clipping of the already cropped precipitation maps with the <code class="highlighter-rouge">mask()</code> function of the raster package:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">clipped_prec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mask</span><span class="p">(</span><span class="n">cropped_prec</span><span class="p">,</span><span class="w"> </span><span class="n">fra</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The result is a <code class="highlighter-rouge">RasterBrick</code> object with 12 layers, one for each month of the year (the difference to a <code class="highlighter-rouge">RasterStack</code> as obove is only how memory is allocated, what does not matter here).</p>

<p>Again, the result can quickly and simply be visualized with <code class="highlighter-rouge">plot()</code></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">clipped_prec</span><span class="o">$</span><span class="n">prec1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="/moer-bsc-project-seminar-SDM//assets/images/maps/map_prec_clipped.png" style="display: block; margin: auto;" /></p>

<h2 id="raster-operations">Raster operations</h2>

<p>The created RasterBrick now contains precipitation values of France on a <em>monthly</em> basis. 
What if we want to have a single precipitation layer with <em>annual</em> precipitation values?
We would need to sum up the values of all 12 precipitation layers for each pixel location.
This can be done by:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">clipped_prec_sum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">clipped_prec</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>An alternative would be to use <code class="highlighter-rouge">stackApply()</code> (see <code class="highlighter-rouge">?stackApply()</code> for details. Note the <code class="highlighter-rouge">na.rm</code> argument).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">clipped_prec_sum_2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">raster</span><span class="o">::</span><span class="n">stackApply</span><span class="p">(</span><span class="n">clipped_prec</span><span class="p">,</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">12</span><span class="p">),</span><span class="w"> </span><span class="n">sum</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The resulting raster map looks like this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">clipped_prec_sum</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="/moer-bsc-project-seminar-SDM//assets/images/maps/map_prec_clipped_sum.png" style="display: block; margin: auto;" /></p>

<p>Note the different value range, which now stands for the annual amount of precipitation (in mm).</p>

<h2 id="mapping">Mapping</h2>

<p>We now combine all the above created spatial objects to create a single simple map:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">clipped_prec_sum</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">fra</span><span class="p">,</span><span class="w"> </span><span class="n">add</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="m">2.349014</span><span class="p">,</span><span class="w"> </span><span class="m">48.864716</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1"># roughly the location of Paris</span><span class="w">
</span></code></pre></div></div>

<p><img src="/moer-bsc-project-seminar-SDM//assets/images/maps/FirstSimpleMap.jpg" style="display: block; margin: auto;" /></p>

<h2 id="write-out">Write out</h2>

<p>The above created overlay of maps can be written to file as an ordinary image with e.g.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">jpeg</span><span class="p">(</span><span class="s2">"FirstSimpleMap.jpg"</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">clipped_prec_sum</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">fra</span><span class="p">,</span><span class="w"> </span><span class="n">add</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="m">2.349014</span><span class="p">,</span><span class="w"> </span><span class="m">48.864716</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p>Note that this is a raster image without geographic information.
If you want to write out the spatial objects with geographic information, use e.g. <code class="highlighter-rouge">raster::writeRaster()</code> or <code class="highlighter-rouge">raster::shapefile()</code>.</p>

<h2 id="other-important-functions">Other important functions</h2>

<ul>
  <li>Reading in raster data from file: <code class="highlighter-rouge">raster::raster()</code></li>
  <li>Reading in vector data from file: <code class="highlighter-rouge">rgdal::readOGR()</code></li>
</ul>

<h2 id="more-information">More information</h2>

<p>For more details see <a href="https://www.rspatial.org/raster/spatial/index.html" target="_blank">www.rspatial.org</a> and 
<a href="https://geocompr.robinlovelace.net/spatial-operations.html#spatial-vec" target="_blank">Geocomputation with R</a></p>


        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-02-12T16:54:47+01:00">February 12, 2020</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/moer-bsc-project-seminar-SDM/unit03/unit03-04_CRS.html" class="pagination--pager" title="Coordinate Reference Systems
">Previous</a>
    
    
      <a href="/moer-bsc-project-seminar-SDM/unit03/unit03-06_exercise_SpatialDataProcessing.html" class="pagination--pager" title="Exercise: Spatial Data Processing
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
    
      <li><a href="https://twitter.com/EnvIn_UMR"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="https://github.com/GeoMOER"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    <li><a href="http://localhost:4000/moer-bsc-project-seminar-SDM/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright"> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a> &copy; 2020 Lab of Environmental Informatics
. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a>, <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a> &amp; <a href="https://www.uni-marburg.de/fb19" rel="nofollow">Geography@Marburg University</a>.</div>



      </footer>
    </div>

    
  <script src="/moer-bsc-project-seminar-SDM/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>








  </body>
</html>
